<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Daniele Grattarola">
  <link rel="canonical" href="https://graphneural.network/creating-dataset/">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Creating a dataset - Spektral</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  <link href="../stylesheets/extra.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Creating a dataset";
    var mkdocs_page_input_path = "creating-dataset.md";
    var mkdocs_page_url = "/creating-dataset/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-125823175-1', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Spektral</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Tutorials</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../getting-started/">Getting started</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../data-modes/">Data modes</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Creating a dataset</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#essential-information">Essential information</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#example">Example</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../creating-layer/">Creating a layer</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../examples/">Examples</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Layers</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../layers/convolution/">Convolutional layers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../layers/pooling/">Pooling layers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../layers/base/">Base layers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../models/">Models</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Data</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../data/">Containers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../datasets/">Datasets</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../loaders/">Loaders</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../transforms/">Transforms</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Utils</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../utils/convolution/">Convolution</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../utils/sparse/">Sparse</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../utils/misc/">Miscellaneous</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Other</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../external/">External resources</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../about/">About</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Spektral</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Tutorials &raquo;</li>
        
      
    
    <li>Creating a dataset</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h2 id="creating-a-custom-dataset">Creating a Custom Dataset</h2>
<p>The <code>Dataset</code> class is a new feature of Spektral 1.0 that standardizes how graph datasets are represented in Spektral. </p>
<p>In this tutorial, we'll go over a simple example to create a custom dataset with your data. </p>
<p>This is also useful if you want to share you datasets publicly or include them as part of Spektral. </p>
<h3 id="essential-information">Essential information</h3>
<p>You create a dataset by subclassing the <code>spektral.data.Dataset</code> class. </p>
<p>The core of datasets is the <code>read()</code> method. This is called at every instantiation of the dataset and must return a list of <code>spektral.data.Graph</code>.
It doesn't matter if you read the data from a file or create it on the fly, this is where the dataset is loaded in memory. </p>
<p>All datasets have a <code>path</code> property that represents the directory in which the data is stored. This defaults to <code>~/spektral/datasets/[ClassName]</code>.
You can ignore it if you want.<br>
However, each time you instantiate a Dataset it will check whether <code>path</code> exists. If it doesn't, the <code>download()</code> method will be called.</p>
<p>You can use <code>download()</code> to define any additional operations that are needed to save your raw data to disk. The method will be called <strong>before</strong> <code>read()</code>.</p>
<p>Both <code>read()</code> and <code>download()</code> are called by the dataset's <code>__init__()</code> method. If you need to override the initialization of your dataset, make sure to call <code>super().__init__()</code> somewhere in your implementation (usually as the last line).</p>
<h3 id="example">Example</h3>
<p>This is a simple example that shows how to create a custom dataset with five random graphs. We pretend that the data comes from an online source so that we can show how to use <code>download()</code>. </p>
<p>We start by overriding the <code>__init__()</code> method to store some custom parameters of the dataset: </p>
<pre><code class="language-py">class MyDataset(Dataset):
    &quot;&quot;&quot;
    A dataset of five random graphs.
    &quot;&quot;&quot;
    def __init__(self, nodes, feats, **kwargs):
        self.nodes = nodes
        self.feats = feats

        super().__init__(**kwargs)
</code></pre>
<p>Remember to call <code>super().__init__(**kwargs)</code> as the last line.</p>
<p>Then, we simulate downloading the data from the web. Since this method gets called if <code>path</code> does not exist on the system, it makes sense to create the corresponding directory now:</p>
<pre><code class="language-py">def download(self):
    data = ...  # Download from somewhere

    # Create the directory
    os.mkdir(self.path)

    # Write the data to file
    for i in range(5):
        x = rand(self.nodes, self.feats)
        a = randint(0, 2, (self.nodes, self.nodes))
        y = randint(0, 2)

        filename = os.path.join(self.path, f'graph_{i}')
        np.savez(filename, x=x, a=a, y=y)
</code></pre>
<p>Finally, we implement the <code>read()</code> method to return a list of <code>Graph</code> objects:</p>
<pre><code class="language-py">def read(self):
    # We must return a list of Graph objects
    output = []

    for i in range(5):
        data = np.load(os.path.join(self.path, f'graph_{i}.npz'))
        output.append(
            Graph(x=data['x'], a=data['a'], y=data['y'])
        )

    return output
</code></pre>
<p>We can now instantiate our dataset, which will "download" our data and read it into memory: </p>
<pre><code>&gt;&gt;&gt; dataset = MyDataset(3, 2)
&gt;&gt;&gt; dataset
MyDataset(n_graphs=5)
</code></pre>
<p>We can see that our graphs were saved to file: </p>
<pre><code class="language-sh">$ ls ~/.spektral/datasets/MyDataset/
graph_0.npz  graph_1.npz  graph_2.npz  graph_3.npz  graph_4.npz
</code></pre>
<p>so the next time we create <code>MyDataset</code> it will read from the files we have saved. </p>
<hr />
<p>You can now use your custom dataset however you like. <a href="/loaders">Loaders</a> will work, as well as <a href="/transforms">transforms</a> and all other features described in the <a href="/data/#dataset">documentation</a>.</p>
<p>Remember that, if you want, you're free to store your data as you prefer. Datasets in Spektral are just there to simplify your workflow, but the library is still designed according to Keras' principle of not getting in your way. If you want to manipulate your data differently, your GNNs will still work. </p>
<p>You can also see <a href="https://github.com/danielegrattarola/spektral/blob/master/examples/graph_prediction/custom_dataset.py">this script</a> for another example on how to create and use a custom dataset.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../creating-layer/" class="btn btn-neutral float-right" title="Creating a layer">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../data-modes/" class="btn btn-neutral" title="Data modes"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/danielegrattarola/spektral/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../data-modes/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../creating-layer/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
      <script src="../js/macros.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
